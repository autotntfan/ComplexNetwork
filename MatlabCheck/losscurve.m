clear
close all
rng(7414)
loss_MSE = [0.021724417805671692, 0.0025424554478377104, 0.002179275266826153, 0.0017054099589586258, 0.007122601382434368, 0.0023105957079678774, 0.0019434099085628986, 0.0016599723603576422, 0.0022660281974822283, 0.0016413630219176412, 0.0015163876814767718, 0.0014969016192480922, 0.0018009700579568744, 0.00141600938513875, 0.0013920617057010531, 0.0013763366732746363, 0.0013837275328114629, 0.0013589594746008515, 0.001346991746686399, 0.0010421356419101357, 0.0006529185920953751, 0.0006156849558465183, 0.0005626538768410683, 0.0005748510011471808, 0.0005595825496129692, 0.0006834361702203751, 0.0005705260555259883, 0.0005927447928115726, 0.0005769034032709897, 0.0005901905242353678, 0.0006215685280039907, 0.000572031072806567, 0.0008270438993349671, 0.0006176692550070584, 0.0005508745089173317, 0.0005375100299715996, 0.0005362991942092776, 0.0005455513601191342, 0.0005459919339045882, 0.0005542563158087432, 0.0005393547471612692, 0.0005193998804315925, 0.0005272976122796535, 0.0005220555467531085, 0.0010608204174786806, 0.0006331833428703249, 0.000656172982417047, 0.0005452048499137163, 0.0005285959341563284, 0.0005256449221633375, 0.0005089364713057876, 0.000508135708514601, 0.000507525575812906, 0.0004980170633643866, 0.0004923702217638493, 0.0004990714369341731, 0.0004992096801288426, 0.0004972894093953073, 0.0004919844795949757, 0.0005122417933307588, 0.0005100885755382478, 0.0005040702526457608, 0.0005105161108076572, 0.0005023583653382957, 0.0005002417019568384, 0.0004998876829631627, 0.0005020587705075741, 0.0005258684977889061, 0.0004970327718183398, 0.000492932100314647, 0.0004948030109517276, 0.0004915439058095217, 0.0004876893654000014, 0.0005055019864812493, 0.0004987078718841076, 0.0005135480314493179, 0.000487450510263443, 0.0004841136105824262, 0.00048012242768891156, 0.00048287026584148407, 0.00048630472156219184, 0.00048185401828959584, 0.00047586028813384473, 0.00046927339280955493, 0.0005019737291149795, 0.00048248458188027143, 0.0004994883202016354, 0.0005191603559069335, 0.0005046583246439695, 0.0004888601833954453, 0.0004915933241136372, 0.0004836572625208646, 0.00047154974890872836, 0.0004652483039535582, 0.0004575905913952738, 0.0004702199366874993, 0.0004677934921346605, 0.0004496720794122666, 0.00044866971438750625, 0.0004553362086880952, 0.0006474917172454298, 0.0005880996468476951, 0.000502640672493726, 0.00048185273772105575, 0.000470061058877036, 0.0004553311737254262, 0.00045937037793919444, 0.00044850888662040234, 0.00043544001528061926, 0.0004371847026050091, 0.00043718129745684564, 0.0004400202014949173, 0.000446046469733119, 0.0006636598845943809, 0.0005664125201292336, 0.0005098614492453635, 0.0005265785148367286, 0.00048703450011089444, 0.0004644639266189188, 0.0004513344611041248, 0.0004487383703235537, 0.0004531965823844075, 0.0004635262303054333, 0.0004415653820615262, 0.0004216165980324149, 0.0004143585974816233, 0.00041442192741669714, 0.00040761774289421737, 0.0004048484843224287, 0.00039979585562832654, 0.00039583127363584936, 0.00039903531433083117, 0.0003899721777997911, 0.0003932229010388255, 0.00039122538873925805, 0.0003845314495265484, 0.0003771143965423107, 0.0003717239305842668, 0.00036741094663739204, 0.00035941984970122576, 0.0003597650211304426, 0.00035652026417665184, 0.00035773139097727835, 0.0003473428660072386, 0.00034444627817720175, 0.0003422912850510329, 0.00032836542231962085, 0.0003357911773491651, 0.00031679231324233115, 0.0003148030664306134, 0.0003039032453671098, 0.0002993181988131255, 0.0002898567181546241, 0.0002829844306688756, 0.000268953648628667, 0.0002741219359450042, 0.00028612310416065156, 0.0002912401978392154, 0.0002683464845176786, 0.00028599670622497797, 0.00025759325944818556, 0.00025371185620315373, 0.00023998069809749722, 0.00024051046057138592, 0.0002614140685182065, 0.00024808821035549045, 0.0002243465860374272, 0.00021938123973086476, 0.00021725613623857498, 0.00025396293494850397, 0.0002453303022775799, 0.00024556354037486017, 0.0002149039355572313, 0.0002567241317592561, 0.00021870019554626197, 0.00024166333605535328, 0.00021744074183516204, 0.00020255069830454886, 0.00020080390095245093, 0.0002050040493486449, 0.0001901868381537497, 0.00018580134201329201, 0.0001735872501740232, 0.00017895895871333778, 0.00021306304552126676, 0.00017848813149612397, 0.0001798821467673406, 0.00016636052168905735, 0.00016527831030543894, 0.00016842006880324334, 0.00015370231994893402, 0.00015248100680764765, 0.00019777573470491916, 0.00016589107690379024, 0.00014792672300245613, 0.0001541013625683263, 0.0001585950521985069, 0.00024644029326736927, 0.00017954253416974097, 0.00015924658509902656];
loss_SSIM = [0.11443587392568588, 0.07257310301065445, 0.07070054858922958, 0.0639297142624855, 0.056645434349775314, 0.054549477994441986, 0.05727459490299225, 0.05271558836102486, 0.05579283460974693, 0.05530928820371628, 0.058555472642183304, 0.05743739381432533, 0.05660169571638107, 0.05392976850271225, 0.0542084239423275, 0.052313607186079025, 0.05328976362943649, 0.05165574327111244, 0.0450071282684803, 0.040419597178697586, 0.03641285374760628, 0.03373297303915024, 0.030726855620741844, 0.026495294645428658, 0.022168772295117378, 0.020302940160036087, 0.020024225115776062, 0.019669856876134872, 0.019627554342150688, 0.019170278683304787, 0.019076233729720116, 0.018803197890520096, 0.01853541098535061, 0.018350452184677124, 0.01801060140132904, 0.0180812980979681, 0.017841102555394173, 0.01769055239856243, 0.017360279336571693, 0.017040185630321503, 0.017059659585356712, 0.017089715227484703, 0.016424601897597313, 0.015858622267842293, 0.01576814614236355, 0.016829999163746834, 0.015444313175976276, 0.01643693447113037, 0.014597984962165356, 0.013954910449683666, 0.013590042479336262, 0.013609657995402813, 0.013354159891605377, 0.013109360821545124, 0.01238938607275486, 0.012045206502079964, 0.012354488484561443, 0.011815608479082584, 0.011801849119365215, 0.01100566890090704, 0.010321014560759068, 0.009705470874905586, 0.009661892428994179, 0.009849127382040024, 0.009275775402784348, 0.00877660233527422, 0.0082242451608181, 0.008088543079793453, 0.007875592447817326, 0.007903550751507282, 0.007913032546639442, 0.007441377732902765, 0.007080723997205496, 0.006799621041864157, 0.0070663150399923325, 0.0068595390766859055, 0.006557829212397337, 0.00627755606546998, 0.0062410710379481316, 0.00619121640920639, 0.005827118642628193, 0.005563067737966776, 0.005650118459016085, 0.005758895538747311, 0.005434962920844555, 0.005158143118023872, 0.004914894700050354, 0.005009162239730358, 0.005188953597098589, 0.004823760129511356, 0.004452173598110676, 0.004493847955018282, 0.00470808194950223, 0.004403054714202881, 0.004198302049189806, 0.004043538123369217, 0.0037310412153601646, 0.0038726720958948135, 0.0036838415544480085, 0.0038375428412109613, 0.0037295238580554724, 0.0035385058727115393, 0.0035220806021243334, 0.003694086102768779, 0.003607504302635789, 0.0033241761848330498, 0.003267077961936593, 0.0033787433058023453, 0.0032957103103399277, 0.003243375336751342, 0.0031944015063345432, 0.0030630214605480433, 0.002959097269922495, 0.002843376947566867, 0.002743071410804987, 0.0026992789935320616, 0.002818170702084899, 0.0027563078328967094, 0.0028568038251250982, 0.0024970194790512323, 0.0024271535221487284, 0.0025128284469246864, 0.0024543460458517075, 0.0024907111655920744, 0.002404348226264119, 0.0030282381922006607, 0.0022898137103766203, 0.002193740801885724, 0.0020868054125458, 0.002388184890151024, 0.002035563811659813, 0.0021862254943698645, 0.001963646151125431, 0.0021145467180758715, 0.0020824552047997713, 0.0020021344535052776, 0.002088002162054181, 0.0019822604954242706, 0.0020667752251029015, 0.001912941224873066, 0.0018729546573013067, 0.0018326175631955266, 0.002001867862418294, 0.002028997056186199, 0.0018629874102771282, 0.001813207403756678, 0.0015793434577062726, 0.0018319057999178767, 0.0017755103763192892, 0.0016364881303161383, 0.0017161114374175668, 0.0016882304335013032, 0.001803858787752688, 0.0016976735787466168, 0.0015904060564935207, 0.0015594928991049528, 0.001916630775667727, 0.00167575862724334, 0.0016040606424212456, 0.0015150896506384015, 0.0015717914793640375, 0.0015687078703194857, 0.001564647420309484, 0.0014179685385897756, 0.0012851357460021973, 0.0014984369045123458, 0.0014743587234988809, 0.0014976956881582737, 0.0014479291858151555, 0.0013033457798883319, 0.0014264046913012862, 0.0013782148016616702, 0.0012751758331432939, 0.0012368146562948823, 0.0012181316269561648, 0.0013955541653558612, 0.0012579875765368342, 0.0011797632323578, 0.0012498454889282584, 0.0012651371071115136, 0.0014046127907931805, 0.001280926400795579, 0.001112134545110166, 0.0011305911466479301, 0.0012146532535552979, 0.0011370322899892926, 0.0010263915173709393, 0.0011977473041042686, 0.0012518218718469143, 0.0013822908513247967, 0.0014257315779104829, 0.00134219357278198, 0.0010987890418618917, 0.0010591979371383786, 0.0010025228839367628, 0.001063623116351664, 0.0011865453561767936, 0.0010995703050866723, 0.0010101011721417308, 0.0010325112380087376];


err_ratio = loss_SSIM./loss_MSE;
figure
plot(loss_SSIM, 'black--')
hold on
plot(loss_MSE, 'black-')
legend('SSIM','MSE')
figure
plot(err_ratio)

loss_MSE_2 = [0.0886506587266922, 0.05444458872079849, 0.04084446281194687, 0.030095547437667847, 0.021671762689948082, 0.015167057514190674, 0.010311915539205074, 0.0067871734499931335, 0.004339978098869324, 0.0027120255399495363, 0.0016830199165269732, 0.0010783131001517177, 0.0007293814560398459, 0.0005500586703419685, 0.0004607588052749634, 0.00041767710354179144, 0.0003979630710091442, 0.0003840033896267414, 0.0003692536847665906, 0.0003616284520830959, 0.00034736705129034817, 0.0003401571011636406, 0.00032185757299885154, 0.00031757185934111476, 0.0003122285124845803, 0.00030424693250097334, 0.0003016408591065556, 0.0002916073426604271, 0.00028697188827209175, 0.0002897609956562519, 0.0002816333726514131, 0.00026424555107951164, 0.00025934219593182206, 0.0002550643985159695, 0.0002572017547208816, 0.00024797700461931527, 0.00023947579029481858, 0.00024110775848384947, 0.00023831795260775834, 0.00022224322310648859, 0.0002226945653092116, 0.00022267800522968173, 0.00021278274653013796, 0.00020512055198196322, 0.00020041111565660685, 0.00019131714361719787, 0.00018010044004768133, 0.0001902827643789351, 0.00017973770445678383, 0.00018432593788020313, 0.00017250890959985554, 0.00016549044812563807, 0.00017301188199780881, 0.00016191390750464052, 0.00015569334209430963, 0.00015036236436571926, 0.00014285447832662612, 0.00014004978584125638, 0.0001396885490976274, 0.00013250598567537963, 0.0001316046400461346, 0.00012915543629787862, 0.0001194624783238396, 0.00012081299792043865, 0.00012020334543194622, 0.000121864395623561, 0.00011714814900187775, 0.0001114673723350279, 0.0001107071730075404, 0.00011209375952603295, 0.00010391802061349154, 0.0001028044571285136, 0.00010833148553501815, 9.46797663345933e-05, 0.00010241977724945173, 9.431900252820924e-05, 9.231212607119232e-05, 9.002424485515803e-05, 8.524648728780448e-05, 8.064210851443931e-05, 7.80484770075418e-05, 8.299190812977031e-05, 8.477446681354195e-05, 7.949989230837673e-05, 7.95460437075235e-05, 7.727323827566579e-05, 7.442490459652618e-05, 7.56172084948048e-05, 7.200425898190588e-05, 6.951062096050009e-05, 7.092205487424508e-05, 6.920775194885209e-05, 6.604234658880159e-05, 6.565410149050876e-05, 6.546193617396057e-05, 6.663463136646897e-05, 6.507227226393297e-05, 6.165634840726852e-05, 6.342306733131409e-05, 5.8260015066480264e-05, 6.003149610478431e-05, 5.865925777470693e-05, 5.6005890655796975e-05, 5.2329200116219e-05, 5.479479659697972e-05, 5.12033402628731e-05, 5.050762047176249e-05, 5.2226980187697336e-05, 5.4433832701761276e-05, 5.1603270549094304e-05, 4.89654739794787e-05, 4.865545633947477e-05, 5.1155686378479004e-05, 5.1756655011558905e-05, 4.686545435106382e-05, 4.6633427700726315e-05, 4.6528166421921924e-05, 4.545466072158888e-05, 4.258643457433209e-05, 4.519227150012739e-05, 4.533677929430269e-05, 4.4687712943414226e-05, 4.2971329094143584e-05, 4.482221629587002e-05, 4.251449354342185e-05, 4.266999167157337e-05, 4.096373595530167e-05, 4.157461444265209e-05, 4.135479321121238e-05, 4.0830800571711734e-05, 3.9571630622958764e-05, 4.137956420890987e-05, 3.748148446902633e-05, 3.9979262510314584e-05, 3.8206897443160415e-05, 3.647368066594936e-05, 3.8911115552764386e-05, 3.544633000274189e-05, 3.8780974136898294e-05, 3.7133460864424706e-05, 3.5316115827299654e-05, 3.750513133127242e-05, 3.676089909276925e-05, 3.591386484913528e-05, 3.5097305953968316e-05, 3.441950320848264e-05, 3.4587352274684235e-05, 3.391253267182037e-05, 3.5849036066792905e-05, 3.4631884773261845e-05, 3.288479274488054e-05, 3.3231390261789784e-05, 3.472837124718353e-05, 3.5260825825389475e-05, 3.2338695746148005e-05, 3.120108158327639e-05, 3.378494147909805e-05, 3.309152089059353e-05, 3.2908494176808745e-05, 3.308796294732019e-05, 3.465800909907557e-05, 3.5242199373897165e-05, 3.197875776095316e-05, 3.2566160371061414e-05, 3.181543434038758e-05, 3.102232949458994e-05, 3.124969589407556e-05, 3.0338596843648702e-05, 2.9307322620297782e-05, 3.0085164326010272e-05, 3.1001243769424036e-05, 3.208294583600946e-05, 3.2518975785933435e-05, 3.000029391841963e-05, 3.184787783538923e-05, 3.0819413950666785e-05, 3.2327436201740056e-05, 3.247492350055836e-05, 3.416893378016539e-05, 3.12121665047016e-05, 3.184741945005953e-05, 2.8781931177945808e-05, 3.0137860449030995e-05, 2.8110585844842717e-05, 2.8448159355320968e-05, 2.7705009415512905e-05, 3.00454212265322e-05, 2.8355954782455228e-05, 2.9441906008287333e-05, 2.773611413431354e-05, 2.8751586796715856e-05, 3.1603714887751266e-05, 3.2037365599535406e-05, 2.682296690181829e-05, 2.9093120247125626e-05, 2.8112010113545693e-05, 2.7691308787325397e-05, 2.926132765423972e-05, 2.9224718673503958e-05, 2.675524228834547e-05];
loss_SSIM_2 = [0.03397039696574211, 0.013802798464894295, 0.012912435457110405, 0.012868780642747879, 0.012856508605182171, 0.012850225903093815, 0.01284630037844181, 0.01284406054764986, 0.012842513620853424, 0.0128409992903471, 0.01283907052129507, 0.012833855114877224, 0.0093498220667243, 0.005637946538627148, 0.005440687760710716, 0.005253246054053307, 0.005136772524565458, 0.004838210996240377, 0.004627999849617481, 0.004395772702991962, 0.004160613287240267, 0.004021582193672657, 0.00378585746511817, 0.0035749180242419243, 0.003352637169882655, 0.0031227758154273033, 0.00290791061706841, 0.0027642196509987116, 0.0025791293010115623, 0.0024854172952473164, 0.002362624043598771, 0.002225482137873769, 0.0020793231669813395, 0.0019415225833654404, 0.001882914686575532, 0.001787857268936932, 0.0017423554090783, 0.0015675389440730214, 0.001560402917675674, 0.001556379604153335, 0.0014570599887520075, 0.0013826227514073253, 0.0013468062970787287, 0.0014038784429430962, 0.0013398336013779044, 0.0011229547671973705, 0.0010667270980775356, 0.0010748611530289054, 0.001141341868788004, 0.0010891524143517017, 0.0010121389059349895, 0.001047073514200747, 0.0009629607084207237, 0.0009229325805790722, 0.0009093516273424029, 0.0009247223497368395, 0.0008960621198639274, 0.0009015576797537506, 0.0008870088495314121, 0.0008295701700262725, 0.0007735762046650052, 0.0007979277288541198, 0.0007720824796706438, 0.000771471532061696, 0.0007804549532011151, 0.0007837000885047019, 0.0007721006986685097, 0.0007627271697856486, 0.000702891091350466, 0.0006965289358049631, 0.0006371136987581849, 0.0006051775417290628, 0.000675779883749783, 0.0006652543670497835, 0.0006697287317365408, 0.0006395045202225447, 0.0006101574981585145, 0.0006089372909627855, 0.0005792544689029455, 0.0005395524785853922, 0.0005172696546651423, 0.0005128695047460496, 0.0005942331627011299, 0.0006010032375343144, 0.0005506743909791112, 0.000531807541847229, 0.0005159735446795821, 0.0004900405765511096, 0.0004650423943530768, 0.00044444401282817125, 0.00043101972551085055, 0.0004581484536174685, 0.0004555821360554546, 0.00046341022243723273, 0.00044869582052342594, 0.000466077181044966, 0.00047554008779115975, 0.0004620369873009622, 0.0004718823474831879, 0.0004066977126058191, 0.0003822402795776725, 0.00037201776285655797, 0.00038288434734568, 0.00036119058495387435, 0.0003619088092818856, 0.0003560695331543684, 0.00033790007000789046, 0.0003529369714669883, 0.0003539853496477008, 0.000353137991623953, 0.0003510845999699086, 0.0003487689536996186, 0.0003392650105524808, 0.00031838647555559874, 0.0003100199974142015, 0.0003082073526456952, 0.00029375951271504164, 0.00029694271506741643, 0.00029073026962578297, 0.0002796984335873276, 0.00028528901748359203, 0.00027184421196579933, 0.00027685859822668135, 0.0002874086203519255, 0.00026758876629173756, 0.00026042660465463996, 0.00025534266023896635, 0.0002573768433649093, 0.0002507941680960357, 0.000252775673288852, 0.00023803777003195137, 0.0002602517488412559, 0.0002494086802471429, 0.00025233658379875124, 0.00025857024593278766, 0.0002599275903776288, 0.00025082958745770156, 0.00023112926282919943, 0.00024132562975864857, 0.00023627844348084182, 0.00022551616712007672, 0.00022004544734954834, 0.00022225678549148142, 0.00021896560792811215, 0.0002120024582836777, 0.00021192265558056533, 0.000204525058506988, 0.00019924243679270148, 0.00019855532445944846, 0.00019371608505025506, 0.00019114745373371989, 0.00019400582823436707, 0.00019568965944927186, 0.0001967407006304711, 0.000191860061022453, 0.00018814901704899967, 0.00019657015218399465, 0.0001879791379906237, 0.00018209881091024727, 0.00017845830006990582, 0.0001846548548201099, 0.00018832518253475428, 0.0001897169422591105, 0.0001851598353823647, 0.00017755330190993845, 0.00016880035400390625, 0.00016563865938223898, 0.00016466478700749576, 0.00016688506002537906, 0.00016915201558731496, 0.00016990867152344435, 0.00016248093743342906, 0.00016049908299464732, 0.00016178886289708316, 0.00015887088375166059, 0.00015982256445568055, 0.0001546770363347605, 0.0001510298898210749, 0.00015438265108969063, 0.00015202992653939873, 0.00014788872795179486, 0.0001488116104155779, 0.00014954109792597592, 0.00014743109932169318, 0.00014927983283996582, 0.00014838940114714205, 0.00014465847925748676, 0.0001415789156453684, 0.0001399821776431054, 0.00013865299115423113, 0.00014006925630383193, 0.00013891028356738389, 0.00014044277486391366, 0.0001386082876706496, 0.00013887583918403834, 0.0001359078596578911, 0.00012995567522011697, 0.00012814799265470356, 0.0001260866702068597, 0.0001277115661650896];

err = abs(loss_SSIM_2 - loss_MSE_2);
err_ratio = loss_SSIM_2./loss_MSE_2;
figure
plot(loss_SSIM_2, 'black--')
hold on
plot(loss_MSE_2, 'black-')
legend('SSIM','MSE')
xlabel('epochs')
ylabel('loss')
figure
plot(err_ratio)
xlabel('epochs')
title('SSIM/MSE ')
n = 356;
signal = [0.2*ones(1,450) 0.2:0.05:0.8 0.8*ones(1,450)];
signal_noise = signal + 0.01*randn(size(signal));
x = linspace(0,2,length(signal));
figure
plot(x,signal,x,signal_noise)
hold on
plot(x(n),signal_noise(n),'r*')
val = zeros(1,length(signal));
for ii = 1:length(signal)
    val(ii) = ssim(signal(n), signal_noise(ii));
end
figure
plot(val)